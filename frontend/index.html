<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal RFID - Biamar UR4</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <!-- <header>
            <h1>üè≠ Portal RFID - Biamar UR4</h1>
            <p class="subtitle">Sistema de Monitoramento de Produ√ß√£o - POC</p>
        </header> -->

        <!-- Navega√ß√£o -->
        <nav class="main-nav">
            <button class="nav-btn active" data-view="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Dashboard</span>
            </button>
            <button class="nav-btn" data-view="auditoria">
                <span class="nav-icon">üîç</span>
                <span class="nav-text">Auditoria</span>
            </button>
            <button class="nav-btn" onclick="showPasswordModal()">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">Configura√ß√µes</span>
            </button>
        </nav>

        <!-- VIEW: DASHBOARD -->
        <div id="dashboard-view" class="view-container active">
                <!-- Estat√≠sticas Principais -->
            <section class="stats-grid-main">
                <div class="stat-card-large highlight">
                    <div class="stat-icon-large">üì¶</div>
                    <div class="stat-content-large">
                        <h3>Produzido Hoje</h3>
                        <p class="stat-value-large" id="completedToday">0</p>
                        <p class="stat-subtext">pe√ßas finalizadas</p>
                    </div>
                </div>
                <div class="stat-card-large success">
                    <div class="stat-icon-large">üèÜ</div>
                    <div class="stat-content-large">
                        <h3>Total Geral</h3>
                        <p class="stat-value-large" id="totalCompleted">0</p>
                        <p class="stat-subtext">pe√ßas produzidas</p>
                    </div>
                </div>
                <div class="stat-card-large active">
                    <div class="stat-icon-large">‚ö°</div>
                    <div class="stat-content-large">
                        <h3>Em Produ√ß√£o</h3>
                        <p class="stat-value-large" id="activeSessions">0</p>
                        <p class="stat-subtext">em andamento</p>
                    </div>
                </div>
            </section>

            <!-- Tempos M√©dios -->
            <section class="stats-grid-secondary">
                <div class="stat-card-medium">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-content">
                        <h3>Tempo M√©dio Hoje</h3>
                        <p class="stat-value" id="avgDurationToday">--</p>
                    </div>
                </div>
                <div class="stat-card-medium">
                    <div class="stat-icon">‚è∞</div>
                    <div class="stat-content">
                        <h3>Tempo M√©dio Geral</h3>
                        <p class="stat-value" id="avgDuration">--</p>
                    </div>
                </div>
            </section>

            <!-- Sess√µes em Produ√ß√£o (Tempo Real) -->
            <section class="section">
                <h2>‚ö° Produ√ß√£o em Andamento</h2>
                <div id="activeSessions-list" class="sessions-list">
                    <p class="empty-state">Nenhuma sess√£o ativa no momento</p>
                </div>
            </section>
        </div>

        

        <!-- VIEW: AUDITORIA -->
        <div id="auditoria-view" class="view-container">
            <!-- Filtros -->
            <section class="section filters-section">
                <h2>üîç Filtros de Auditoria</h2>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="filterStartDate">Data In√≠cio</label>
                        <input type="date" id="filterStartDate" class="filter-input">
                    </div>
                    <div class="filter-group">
                        <label for="filterEndDate">Data Fim</label>
                        <input type="date" id="filterEndDate" class="filter-input">
                    </div>
                    <div class="filter-group">
                        <label for="filterTag">Tag ID</label>
                        <input type="text" id="filterTag" class="filter-input" placeholder="Digite o ID da tag...">
                    </div>
                    <div class="filter-group">
                        <label for="filterStatus">Status</label>
                        <select id="filterStatus" class="filter-input">
                            <option value="">Todos</option>
                            <option value="em_producao">Em Produ√ß√£o</option>
                            <option value="finalizado">Finalizado</option>
                        </select>
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-primary" onclick="applyFilters()">üîç Aplicar Filtros</button>
                    <button class="btn btn-secondary" onclick="clearFilters()">üîÑ Limpar</button>
                    <button class="btn btn-success" onclick="exportData()">üì• Exportar CSV</button>
                </div>
            </section>

            <!-- Resumo dos Filtros -->
            <section class="section">
                <h3>üìä Resumo do Per√≠odo</h3>
                <div class="summary-grid">
                    <div class="summ(POC) ary-item">
                        <span class="summary-label">Total de Registros:</span>
                        <span class="summary-value" id="summaryTotal">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Finalizados:</span>
                        <span class="summary-value" id="summaryFinalized">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Tempo M√©dio:</span>
                        <span class="summary-value" id="summaryAvgTime">--</span>
                    </div>
                </div>
            </section>

            <!-- Tabela de Auditoria -->
            <section class="section">
                <h2>üìã Hist√≥rico Completo</h2>
                <div class="table-container">
                    <table id="auditTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tag ID</th>
                                <th>Entrada (Antena 1)</th>
                                <th>Sa√≠da (Antena 2)</th>
                                <th>Tempo de Produ√ß√£o</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="auditTableBody">
                            <tr>
                                <td colspan="6" class="empty-state">Carregando dados...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Log de Eventos -->
            <section class="section">
                <h2>üîî Log de Eventos RFID</h2>
                <div id="auditEvents" class="events-list">
                    <p class="empty-state">Nenhum evento no per√≠odo</p>
                </div>
            </section>

            <!-- Leituras Rejeitadas/Bloqueadas -->
            <section class="section">
                <h2>üö´ Leituras Rejeitadas</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tag ID</th>
                                <th>Antena</th>
                                <th>Data/Hora</th>
                                <th>Motivo</th>
                                <th>Tipo</th>
                            </tr>
                        </thead>
                        <tbody id="rejectedTableBody">
                            <tr>
                                <td colspan="5" class="empty-state">Nenhuma leitura rejeitada</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- VIEW: CONFIGURA√á√ïES -->
        <div id="configuracoes-view" class="view-container">
            <section class="section">
                <h2>‚öôÔ∏è Configura√ß√µes do Portal</h2>
                
                <!-- Informa√ß√µes do Dispositivo UR4 -->
                <div class="device-info-card">
                    <div class="device-header">
                        <div class="device-icon">üìü</div>
                        <div class="device-title">
                            <h3>Leitor RFID UR4</h3>
                            <span class="device-status" id="deviceStatus">
                                <span class="status-dot"></span> Verificando...
                            </span>
                        </div>
                    </div>
                    
                    <div class="device-details-grid">
                        <div class="device-detail-item">
                            <span class="detail-icon">üî¢</span>
                            <div class="detail-content">
                                <span class="detail-label">N√∫mero de S√©rie</span>
                                <span class="detail-value" id="deviceSerial">Carregando...</span>
                            </div>
                        </div>
                        
                        <div class="device-detail-item">
                            <span class="detail-icon">üíæ</span>
                            <div class="detail-content">
                                <span class="detail-label">Vers√£o Firmware</span>
                                <span class="detail-value" id="deviceFirmware">Carregando...</span>
                            </div>
                        </div>
                        
                        <div class="device-detail-item">
                            <span class="detail-icon">üîå</span>
                            <div class="detail-content">
                                <span class="detail-label">Porta Serial</span>
                                <span class="detail-value" id="devicePort">Carregando...</span>
                            </div>
                        </div>
                        
                        <div class="device-detail-item">
                            <span class="detail-icon">üì∂</span>
                            <div class="detail-content">
                                <span class="detail-label">Antena 1 - Pot√™ncia</span>
                                <span class="detail-value" id="deviceAnt1Power">Carregando...</span>
                            </div>
                        </div>
                        
                        <div class="device-detail-item">
                            <span class="detail-icon">üì∂</span>
                            <div class="detail-content">
                                <span class="detail-label">Antena 2 - Pot√™ncia</span>
                                <span class="detail-value" id="deviceAnt2Power">Carregando...</span>
                            </div>
                        </div>
                        
                        <div class="device-detail-item">
                            <span class="detail-icon">üéöÔ∏è</span>
                            <div class="detail-content">
                                <span class="detail-label">Modo de Trabalho</span>
                                <span class="detail-value" id="deviceWorkMode">Carregando...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="device-actions">
                        <button class="btn btn-secondary btn-sm" onclick="refreshDeviceInfo()">
                            üîÑ Atualizar Informa√ß√µes
                        </button>
                    </div>
                </div>
                
                <!-- Configura√ß√µes de Antenas -->
                <div class="config-section">
                    <h3>üì° Configura√ß√£o de Antenas</h3>
                    <div class="config-grid">
                        <div class="config-item">
                            <label for="configAntenna1">
                                <input type="checkbox" id="configAntenna1" checked>
                                Antena 1 (Entrada)
                            </label>
                            <div class="config-details">
                                <label>Pot√™ncia (dBm):</label>
                                <input type="number" id="configAntenna1Power" class="config-input" value="30" min="0" max="33">
                            </div>
                        </div>
                        <div class="config-item">
                            <label for="configAntenna2">
                                <input type="checkbox" id="configAntenna2" checked>
                                Antena 2 (Sa√≠da)
                            </label>
                            <div class="config-details">
                                <label>Pot√™ncia (dBm):</label>
                                <input type="number" id="configAntenna2Power" class="config-input" value="30" min="0" max="33">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes de Porta Serial -->
                <div class="config-section">
                    <h3>üîå Porta Serial</h3>
                    <div class="config-grid">
                        <div class="config-item full-width">
                            <label>Porta:</label>
                            <input type="text" id="configSerialPort" class="config-input" placeholder="AUTO ou COM1, COM3, etc." value="AUTO">
                            <small class="config-hint">Use "AUTO" para detec√ß√£o autom√°tica ou especifique a porta (COM1, COM3, /dev/ttyUSB0, etc.)</small>
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes de Valida√ß√£o -->
                <div class="config-section">
                    <h3>üõ°Ô∏è Valida√ß√µes</h3>
                    <div class="config-grid">
                        <div class="config-item full-width">
                            <label for="configBlockDuplicates">
                                <input type="checkbox" id="configBlockDuplicates" checked>
                                Bloquear etiquetas j√° produzidas
                            </label>
                            <small class="config-hint">Impede que etiquetas finalizadas entrem em produ√ß√£o novamente</small>
                        </div>
                        <div class="config-item full-width">
                            <label>Tamanho esperado da tag (caracteres):</label>
                            <input type="number" id="configTagLength" class="config-input" value="24" min="1" max="100">
                            <small class="config-hint">Tags com tamanho diferente ser√£o rejeitadas</small>
                        </div>
                    </div>
                </div>

                <!-- Configura√ß√µes de Sistema -->
                <div class="config-section">
                    <h3>üñ•Ô∏è Sistema</h3>
                    <div class="config-grid">
                        <div class="config-item">
                            <label>Intervalo de atualiza√ß√£o (segundos):</label>
                            <input type="number" id="configRefreshInterval" class="config-input" value="3" min="1" max="60">
                        </div>
                        <div class="config-item">
                            <label>Portal ID:</label>
                            <input type="text" id="configPortalId" class="config-input" value="biamar_ur4_01" readonly>
                            <small class="config-hint">Identificador √∫nico deste portal</small>
                        </div>
                    </div>
                </div>

                <!-- A√ß√µes -->
                <div class="config-actions">
                    <button class="btn btn-success" onclick="saveConfiguration()">üíæ Salvar Configura√ß√µes</button>
                    <button class="btn btn-secondary" onclick="resetConfiguration()">üîÑ Restaurar Padr√£o</button>
                    <button class="btn btn-danger" onclick="clearDatabase()">üóëÔ∏è Limpar Banco de Dados</button>
                </div>

                <!-- Informa√ß√µes do Sistema -->
                <div class="config-section">
                    <h3>‚ÑπÔ∏è Informa√ß√µes do Sistema</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Vers√£o:</span>
                            <span class="info-value">1.0.0</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Banco de Dados:</span>
                            <span class="info-value" id="dbPath">database/rfid_portal.db</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total de Tags:</span>
                            <span class="info-value" id="totalTags">0</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total de Sess√µes:</span>
                            <span class="info-value" id="totalSessions">0</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal de Senha -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîê Acesso √†s Configura√ß√µes</h3>
                <button class="modal-close" onclick="closePasswordModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p>Digite a senha para acessar as configura√ß√µes:</p>
                <input type="password" id="passwordInput" class="config-input" placeholder="Senha" autocomplete="off">
                <div id="passwordError" class="password-error"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePasswordModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="validatePassword()">Entrar</button>
            </div>
        </div>
    </div>

    <footer>
        <p>Portal RFID - Biamar UR4 | Status: <span id="apiStatus" class="status-indicator">Conectando...</span></p>
        <p class="footer-info">√öltima atualiza√ß√£o: <span id="lastUpdate">--:--:--</span></p>
    </footer>

    <!-- Notifica√ß√µes -->
    <div id="notificationContainer"></div>

    <script src="/static/app.js"></script>
</body>
</html>
